<app-page-title back="/client/certifications/list" [title]="title"
                [breadcrumbs]="breadcrumbs"></app-page-title>
<form role="form" class="form-horizontal form-label-left" [formGroup]="certificationForm" (submit)="onSubmit()">

  <ng-template #loadingIndicator>
    <div class="text-center">
      <img width="70px" src="assets/img/gears2.svg" alt="">
      <h4>Cargando Certificación...</h4>
    </div>
  </ng-template>
  <div *ngIf="!loading; else loadingIndicator">
    <div>
      <div class="row">
        <div class="col-xs-12">
          <div class="x_panel">
            <div class="x_title">
              <h2>Información General
              </h2>
              <div class="clearfix"></div>
            </div>
            <div class="x_content">
              <div class="row">
                <div class="col-xs-12 col-md-6">
                  <div class="form-group"
                       [ngClass]="{'has-error':!certificationForm.controls['name'].valid  && certificationForm.controls['name'].touched}">
                    <label class="control-label col-md-3 col-sm-3 col-xs-12">Nombre</label>
                    <div class="col-xs-12 col-md-9 col-sm-9">
                      <input formControlName="name" class="form-control" placeholder="Nombre de la Certificación"
                             id="name"/>
                      <control-messages [control]="certificationForm.controls['name']"></control-messages>
                    </div>
                  </div>
                  <div class="form-group"
                       [ngClass]="{'has-error':!certificationForm.controls['sku'].valid  && certificationForm.controls['sku'].touched}">
                    <label class="control-label col-md-3 col-sm-3 col-xs-12">Código</label>
                    <div class="col-xs-12 col-md-9 col-sm-9">
                      <input formControlName="sku" class="form-control"
                             placeholder="Código o Sku"
                             id="sku"/>
                      <control-messages [control]="certificationForm.controls['sku']"></control-messages>
                    </div>
                  </div>
                </div>
                <div class="col-xs-12 col-md-6">
                  <div class="form-group"
                       [ngClass]="{'has-error':!certificationForm.controls['description'].valid  && certificationForm.controls['description'].touched}">
                    <label class="control-label col-md-3 col-sm-3 col-xs-12">Descripción</label>
                    <div class="col-xs-12 col-md-9 col-sm-9">
                    <textarea formControlName="description" class="form-control"
                              placeholder="Descripción" rows="3"
                              id="description"></textarea>
                      <control-messages [control]="certificationForm.controls['description']"></control-messages>
                    </div>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-xs-12 col-md-6">
                  <div class="form-group"
                       [ngClass]="{'has-error':!certificationForm.controls['institute_id'].valid  && certificationForm.controls['institute_id'].touched}">
                    <label class="control-label col-md-3 col-sm-3 col-xs-12">Instituto</label>
                    <div class="col-xs-12 col-md-9 col-sm-9">
                      <p-dropdown [options]="institutes" formControlName="institute_id" [filter]="true"
                                  placeholder="Seleccione un instituto"></p-dropdown>
                      <control-messages [control]="certificationForm.controls['institute_id']"></control-messages>
                    </div>
                  </div>
                </div>
                <div class="col-xs-12 col-md-6">
                  <div class="form-group"
                       [ngClass]="{'has-error':!certificationForm.controls['status_id'].valid  && certificationForm.controls['status_id'].touched}">
                    <label class="control-label col-md-3 col-sm-3 col-xs-12 multiline">Status
                    </label>
                    <div class="col-xs-12 col-md-9 col-sm-9">

                      <p-dropdown [options]="status" formControlName="status_id" [filter]="true"
                                  placeholder="Seleccione un status"></p-dropdown>
                      <control-messages [control]="certificationForm.controls['status_id']"></control-messages>

                    </div>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-xs-12 col-md-6">
                  <div class="form-group"
                       [ngClass]="{'has-error':!certificationForm.controls['validity_time_unit'].valid  && certificationForm.controls['validity_time_unit'].touched}">
                    <label class="control-label col-md-3 col-sm-3 col-xs-12 multiline">Unidad del tiempo de validez
                    </label>
                    <div class="col-xs-12 col-md-9 col-sm-9">
                      <p-dropdown [options]="VALIDITY_UNITS" formControlName="validity_time_unit" [filter]="true"
                                  placeholder="Seleccione una unidad de tiempo de validez"></p-dropdown>
                      <control-messages [control]="certificationForm.controls['validity_time_unit']"></control-messages>
                    </div>
                  </div>
                </div>
                <div class="col-xs-12 col-md-6">
                  <div class="form-group"
                       [ngClass]="{'has-error':!certificationForm.controls['validity_time'].valid  && certificationForm.controls['validity_time'].touched}">
                    <label class="control-label col-md-3 col-sm-3 col-xs-12">Tiempo de Validez</label>
                    <div class="col-xs-12 col-md-9 col-sm-9">
                      <input formControlName="validity_time" class="form-control" placeholder="Tiempo de Validez"
                             id="validity_time" [textMask]="{mask:validityMask,guide:false}"/>
                      <control-messages [control]="certificationForm.controls['validity_time']"></control-messages>
                    </div>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-xs-12 col-md-6">
                  <div class="form-group"
                       [ngClass]="{'has-error':!certificationForm.controls['type'].valid  && certificationForm.controls['type'].touched}">
                    <label class="control-label col-md-3 col-sm-3 col-xs-12">Aplica A</label>
                    <div class="col-xs-12 col-md-9 col-sm-9">
                      <div class="radio">
                        <label><input type="radio" formControlName="type" value="0"> Activo</label>
                      </div>
                      <div class="radio">
                        <label><input type="radio" formControlName="type" value="1"> Trabajador
                        </label>
                      </div>
                      <div class="radio">
                        <label><input type="radio" formControlName="type" value="2"> Ambos</label>
                      </div>
                      <control-messages
                        [control]="certificationForm.controls['type']"></control-messages>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="row"
           *ngIf="certificationId && (certificationForm.controls['type'].value == '0' || certificationForm.controls['type'].value == '2')">
        <div class="col-xs-12">
          <div class="x_panel">
            <div class="x_title">
              <h2>Activos con esta certificación
              </h2>
              <div class="clearfix"></div>
            </div>
            <div class="x_content">
              <p-dataTable [value]="certificationsAssets" [responsive]="true" [rows]="10"
                           [paginator]="true" emptyMessage="No se encontraron registros" [pageLinks]="3"
                           [rowsPerPageOptions]="[10,20,50]"
                           [totalRecords]="certificationsAssets.length">
                <p-column [header]="'Código'">
                  <ng-template let-asset="rowData" pTemplate="body">
                    {{asset.sku}}
                  </ng-template>
                </p-column>
                <p-column [header]="'Nombre'">
                  <ng-template let-asset="rowData" pTemplate="body">
                    {{asset.name}}
                  </ng-template>
                </p-column>
                <p-column [header]="'Serial'">
                  <ng-template let-asset="rowData" pTemplate="body">
                    {{asset.serial}}
                  </ng-template>
                </p-column>
                <p-column styleClass="col-button" [header]="'Acciones'">
                  <ng-template let-asset="rowData" pTemplate="body">
                    <button type="button" pButton (click)="removeAsset(asset)" class="ui-button-danger"
                            icon="fa-trash"></button>
                  </ng-template>
                </p-column>
              </p-dataTable>
            </div>
          </div>
        </div>
      </div>
      <div class="row"
           *ngIf="certificationId && (certificationForm.controls['type'].value == '1' || certificationForm.controls['type'].value == '2')">
        <div class="col-xs-12">
          <div class="x_panel">
            <div class="x_title">
              <h2>Trabajadores con esta certificación
              </h2>
              <div class="clearfix"></div>
            </div>
            <div class="x_content">
              <p-dataTable [value]="certificationsWorkers" [responsive]="true" [rows]="10"
                           [paginator]="true" emptyMessage="No se encontraron registros" [pageLinks]="3"
                           [rowsPerPageOptions]="[10,20,50]"
                           [totalRecords]="certificationsWorkers.length">
                <p-column [header]="'Nombre'">
                  <ng-template let-worker="rowData" pTemplate="body">
                    {{worker.full_name}}
                  </ng-template>
                </p-column>
                <p-column [header]="'Rut/Pasaporte'">
                  <ng-template let-worker="rowData" pTemplate="body">
                    {{worker.rut_passport}}
                  </ng-template>
                </p-column>
                <p-column [header]="'Cargo'">
                  <ng-template let-worker="rowData" pTemplate="body">
                    {{worker.position}}
                  </ng-template>
                </p-column>
                <p-column styleClass="col-button" [header]="'Acciones'">
                  <ng-template let-worker="rowData" pTemplate="body">
                    <button type="button" pButton (click)="removeWorker(worker)" class="ui-button-danger"
                            icon="fa-trash"></button>
                  </ng-template>
                </p-column>
              </p-dataTable>
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-xs-12">
          <div class="toolbar text-center">
            <button class="btn btn-danger btn-lg" type="button" (click)="cancel()">
              <i class="fa fa-trash"></i>
              Cancelar
            </button>
            <button class="btn btn-success btn-lg" type="submit" [disabled]="!certificationForm.valid || saving">
              <i class="fa fa-save"></i>
              Guardar
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</form>

